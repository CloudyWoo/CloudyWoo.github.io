---
layout: single

title:  "[Python/Quant] WICS ê¸°ì¤€ ì„¹í„° ì •ë³´ í¬ë¡¤ë§"
excerpt: ""

categories: 
    - Python
tags: [python, quant]

toc: true
author_profile: false
sidebar:
    nav: "docs"

date: 2022-08-27
last_modified_at: 2022-08-27
---

## WICS ê¸°ì¤€ ì„¹í„° ì •ë³´ í¬ë¡¤ë§

[FnGuide Index](https://www.wiseindex.com/)

<aside>
ğŸ’¡ JSON vs. XML
WICS ë°ì´í„° íŒ¨í‚¤ì§€ëŠ” JSON í˜•ì‹ì˜ ë°ì´í„°ì´ë‹¤. ê¸°ì¡´ì— ìš°ë¦¬ê°€ ì‚´í´ë³´ì•˜ë˜ ëŒ€ë¶€ë¶„ì˜ ì›¹í˜ì´ì§€ëŠ” XML í˜•íƒœì˜€ë‹¤.
XMLì€ ë¬¸ë²•ì´ ë³µì¡í•˜ê³  í‘œí˜„ ê·œì¹™ì´ ì—„ê²©í•´ ë°ì´í„°ì˜ ìš©ëŸ‰ì´ ì»¤ì§€ëŠ” ë‹¨ì ì´ ì¡´ì¬í•œë‹¤. ë°˜ë©´ JSON í˜•ì‹ì€ ë¬¸ë²•ì´ ë‹¨ìˆœí•˜ê³  ë°ì´í„°ì˜ ìš©ëŸ‰ì´ ì‘ì•„ ë¹ ë¥¸ ì†ë„ë¡œ ë°ì´í„°ë¥¼ êµí™˜í•  ìˆ˜ ìˆë‹¤.
Rì—ì„œëŠ” jsonlite íŒ¨í‚¤ì§€ì˜ `fromJSON()` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ JSON í˜•ì‹ ë°ì´í„°ë¥¼ í¬ë¡¤ë§í•  ìˆ˜ ìˆë‹¤.

</aside>

```r
# ceil_yn = 0 : ì‹¤ë§ ì—¬ë¶€, 0ì€ ë¹„ì‹¤ë§
# dt=20190607 : ì¡°íšŒì¼ì
# sec_cd=G10 : ì„¹í„°ì½”ë“œ
# lapply() : 

library(jsonlite)

url = 'https://www.wiseindex.com/Index/GetIndexComponets?ceil_yn=0&dt=20190607&sec_cd=G10'
data = fromJSON(url)

lapply(data, head)

# ---- output ---- #

## $info
## $info$TRD_DT
## [1] "/Date(1559833200000)/"
## 
## $info$MKT_VAL
## [1] 19850082
## 
## $info$TRD_AMT
## [1] 70030
## 
## $info$CNT
## [1] 23
## 
## 
## $list # í•´ë‹¹ ì„¹í„°ì˜ êµ¬ì„±ì¢…ëª© ì •ë³´ ì¡´ì¬
##   IDX_CD  IDX_NM_KOR ALL_MKT_VAL CMP_CD            CMP_KOR MKT_VAL   WGT S_WGT
## 1    G10 WICS ì—ë„ˆì§€    19850082 096770       SKì´ë…¸ë² ì´ì…˜ 9052841 45.61 45.61
## 2    G10 WICS ì—ë„ˆì§€    19850082 010950              S-Oil 3403265 17.14 62.75
## 3    G10 WICS ì—ë„ˆì§€    19850082 267250     í˜„ëŒ€ì¤‘ê³µì—…ì§€ì£¼ 2873204 14.47 77.23
## 4    G10 WICS ì—ë„ˆì§€    19850082 078930                 GS 2491805 12.55 89.78
## 5    G10 WICS ì—ë„ˆì§€    19850082 067630 ì—ì´ì¹˜ì—˜ë¹„ìƒëª…ê³¼í•™  624986  3.15 92.93
## 6    G10 WICS ì—ë„ˆì§€    19850082 006120       SKë””ìŠ¤ì»¤ë²„ë¦¬  257059  1.30 94.22
##   CAL_WGT SEC_CD SEC_NM_KOR SEQ TOP60 APT_SHR_CNT
## 1       1    G10     ì—ë„ˆì§€   1     2    56403994
## 2       1    G10     ì—ë„ˆì§€   2     2    41655633
## 3       1    G10     ì—ë„ˆì§€   3     2     9283372
## 4       1    G10     ì—ë„ˆì§€   4     2    49245150
## 5       1    G10     ì—ë„ˆì§€   5     2    39307272
## 6       1    G10     ì—ë„ˆì§€   6     2    10470820
## 
## $sector # ë‹¤ë¥¸ ì„¹í„°ì˜ ì½”ë“œë„ í™•ì¸ ê°€ëŠ¥ URLì˜ sec_cd= ë¶€ë¶„ ë³€ê²½í•˜ì—¬ ëª¨ë“  ì„¹í„° êµ¬ì„±ì¢…ëª© ì‰½ê²Œ í™•ì¸ ê°€ëŠ¥
##   SEC_CD         SEC_NM_KOR SEC_RATE IDX_RATE
## 1    G25     ê²½ê¸°ê´€ë ¨ì†Œë¹„ì¬    16.05        0
## 2    G35           ê±´ê°•ê´€ë¦¬     9.27        0
## 3    G50 ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ì„œë¹„ìŠ¤     2.26        0
## 4    G40               ê¸ˆìœµ    10.31        0
## 5    G10             ì—ë„ˆì§€     2.37      100
## 6    G20             ì‚°ì—…ì¬    12.68        0
## 
## $size
##   SEC_CD    SEC_NM_KOR SEC_RATE IDX_RATE
## 1 WMI510 WMI500 ëŒ€í˜•ì£¼    69.40    89.78
## 2 WMI520 WMI500 ì¤‘í˜•ì£¼    13.56     4.44
## 3 WMI530 WMI500 ì†Œí˜•ì£¼    17.04     5.78
```

```r
# paste() / paste(..., sep = " ", collapse = NULL)
# ë‚˜ì—´ëœ ì›ì†Œ ì‚¬ì´ **ê³µë°±ì„ ë‘ê³ ** ê²°ê³¼ê°’ì„ ì¶œë ¥

# paste0() / paste0(..., collapse = NULL)
# ë‚˜ì—´ëœ ì›ì†Œ ì‚¬ì´ **ê³µë°±ì—†ì´** ì¶œë ¥

# fromJSON()
#

# do.call()
#

# rbind()
#

sector_code = c('G25','G35','G50','G40','G10','G10')

data_sector = list()

for(i in sector_code) {
	url = paste0(
		'http://www.wiseindex.com/Index/GetIndexComponets',
    '?ceil_yn=0&dt=',biz_day,'&sec_cd=',i)
	data = fromJSON(url)
	data = data$list

	data_sector[[i]] = data

	Sys.sleep(1)
}

data_sector = do.call(rbind, data_sector)

write.csv(data_sector, 'data/KOR_sector.csv')
```

## ìˆ˜ì •ì£¼ê°€, ì¬ë¬´ì œí‘œ, ê°€ì¹˜ì§€í‘œ í¬ë¡¤ë§

### ìˆ˜ì •ì£¼ê°€ í¬ë¡¤ë§

1. API + `getSymbols()` í•¨ìˆ˜ ì´ìš© - Yahoo Finanace
2. ìˆ˜ì •ì£¼ê°€ êµ¬í•˜ê¸° ì‰¬ì›€ - Naver Finance

```r
library(stringr)

KOR_ticker = read.csv('data/KOR_ticker.csv', row.names = 1)
print(KOR_ticker$'ì¢…ëª©ì½”ë“œ'[1])
```

```r
library(xts)

ifelse(dir.exists('data/KOR_price'), FALSE,
			 dir.create('data/KOR_price'))
```
